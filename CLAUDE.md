# CLAUDE.md

## 目的

このドキュメントは、Claude Code の作業方針とプロジェクト固有のルールを定義します。

## 判断記録のルール

作業中の重要な判断については、以下の内容を記録してください。

- 判断内容の要約
- 検討した代替案
- 採用しなかった案とその理由
- 前提条件・仮定・不確実性
- 他エージェントによるレビューの要否

## プロジェクト概要

- **目的**: PeX の投資案件および定期預金案件をクロールし、更新があれば Discord に通知する
- **主な機能**: PeX 案件のスクレイピング、状態変化の検知、Discord 通知

## 重要ルール

- 会話は日本語で行う。
- コミットメッセージは [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) に従い、`<description>` は日本語で記載する。
- コード内のコメントは日本語で記載する。
- エラーメッセージは原則として英語で記載する。

## 環境のルール

- **ブランチ命名**: [Conventional Branch](https://conventional-branch.github.io) に従う。`<type>` は短縮形（feat, fix）を使用。
- **リポジトリ調査**: GitHub リポジトリを調査する場合は、一時ディレクトリにクローンして検索する。
- **Renovate**: Renovate が作成した PR に対して追加コミットを行わない。

## コード改修時のルール

- 日本語と英数字の間には半角スペースを挿入する。
- 既存のエラーメッセージで絵文字が使用されている場合、それに合わせて適切な絵文字を先頭に付与する。
- TypeScript において `skipLibCheck` を有効にしてエラーを回避してはならない。
- 関数やインターフェースには JSDoc コメントを日本語で記載する。

## 相談ルール

- **Codex CLI**: 実装の詳細なレビューや、局所的な設計、コード間の整合性確認が必要な場合に相談する。
- **Gemini CLI**: 外部仕様、ライブラリの最新情報、広範な技術情報の確認が必要な場合に相談する。
- 指摘された内容については真摯に対応し、理由なく無視してはならない。

## 開発コマンド

```bash
# インストール
pnpm install

# 実行
pnpm start

# 開発
pnpm dev

# テスト
pnpm test

# Lint
pnpm lint

# 自動修正
pnpm fix
```

## アーキテクチャと主要ファイル

- **src/main.ts**: メインロジック。スクレイピングと通知のフローを管理。
- **src/config.ts**: 設定管理クラス `PexConfiguration` の定義。
- **src/notified.ts**: 通知済み案件の永続化管理クラス `Notified` の定義。

## 実装パターン

- 設定管理には `@book000/node-utils` の `ConfigFramework` を使用する。
- スクレイピングには `cheerio` を使用する。

## テスト

- フレームワークとして `jest` を使用する。
- ロジックの変更や新機能追加時には、可能な限りテストコードを追加または更新する。

## ドキュメント更新ルール

- 設定の構造を変更した場合は、必ず `schema/` ディレクトリが存在することを確認し（存在しない場合は `mkdir -p schema` などで作成し）、その上で `pnpm generate-schema` を実行して `schema/Configuration.json` を更新する。

## 作業チェックリスト

### 新規改修時

1. プロジェクトの詳細を理解する。
2. 作業ブランチが適切であることを確認する。
3. 最新のリモートブランチに基づいていることを確認する。
4. 依存パッケージをインストールする。

### コミット・プッシュ前

1. Conventional Commits に従っているか確認する。
2. 機密情報が含まれていないか確認する。
3. `pnpm lint` でエラーが発生しないことを確認する。
4. 動作確認を行う。

### PR 作成前

1. ユーザーから PR 作成の依頼があることを確認する。
2. コンフリクトの恐れがないか確認する。

### PR 作成後

1. CI の結果を確認する。
2. GitHub Copilot レビューや他エージェントのレビューに対応する。

## リポジトリ固有

- 案件のステータス（受付中、受付終了など）の変化を検知して通知する仕組みとなっている。
